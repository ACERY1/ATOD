<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>ATOD</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
  <!-- 方便本地调试 CDN太慢了.. -->
  <script src="./pixi.min.js"></script>
  <script>
    const app = new PIXI.Application();

    //Aliases
    let Application = PIXI.Application,
      loader = PIXI.loader,
      resources = PIXI.loader.resources,
      Sprite = PIXI.Sprite,
      TextureCache = PIXI.utils.TextureCache,
      Rectangle = PIXI.Rectangle

    // FullScreenModel
    const makeFullScreen = (app, opts) => {
      app.renderer.view.style.position = "absolute";
      app.renderer.view.style.display = "block";
      app.renderer.autoResize = true;
      app.renderer.resize(window.innerWidth, window.innerHeight);
    }

    // store photo to GPU
    // @return Array
    const makePhotoCache = (urls) => {
      if (!urls || urls.length < 1) {
        throw new ReferenceError('cache photo fail');
      }
      const textures = [];
      urls.forEach(url => {
        let texture = PIXI.utils.TextureCache[url];
        if (texture) {
          textures.push(texture);
        }
      });
      return textures;
    }



    // load photo
    PIXI.loader
      .add({ name: 'human', url: './person.png' })
      .load(setup); // call setup function below 


    function setup() {
      // best practice
      // let footman = new PIXI.Sprite(PIXI.loader.resources['human'].texture);
      
      // firstRender
      let texture = TextureCache['human'];
      let rectangle = new Rectangle(0, 0, 64, 64);
      let footman = new Sprite(texture);
      texture.frame = rectangle;
      app.stage.addChild(footman);

      const count = 7;
      let xCount = 0;
      let yCount = 0;
      let actionCount = 0;
      const action1 = () => {
        // footman.visible = !footman.visible;
        rectangle.x = xCount%count * 64
        if (xCount === 7) {
          xCount = 0;
          yCount ++;
          rectangle.y = yCount % count * 64
        }
        // rectangle.y = xCount%count * 64
        texture.frame = rectangle;
        xCount++
      }

      // move ticker
      const gameLoop = (delta) => {
        // footman.x += 1;
        if (actionCount % 5 === 0) {
          // 12 frames?
          action1();
          actionCount =0;
        }
        actionCount ++ ;
        // action1() // too fast TODO: how to make it slow?
      }
      app.ticker.add(delta => gameLoop(delta));
    }

    // load game look at https://github.com/Zainking/LearningPixi
    makeFullScreen(app);
    app.renderer.backgroundColor = 0x061639;
    document.body.appendChild(app.view);
  </script>
</body>

</html>